%!TEX root = twig.tex

\section{Expression Identities}
\label{ch:expr-ids}

In this section we prove the identity relationships between
expressions. We exploit these relationships in expression
reductions, as described above.

\subsection{Distribution of sequence over choice}

First, we show that sequence distributes over choice from the
left, but not from the right.

\subsubsection{From the left}

First we will show that sequence distributes over choice from the
left. We must prove that

\begin{equation}
\forall f,g,h \in S \;:\; f;(g|h) = (f;g)|(f;h)
\end{equation}

There are two cases to be proved. First,

\begin{equation}
t \arr{f;(g|h)} t' \implies t \arr{(f;g)|(f;h)} t'
\end{equation}

and second,

\begin{equation}
t \arr{f;(g|h)} \bot \implies t \arr{(f;g)|(f;h)} \bot
\end{equation}

To prove the first case, we assume the premise

\begin{equation}
t \arr{f;(g|h)} t'
\end{equation}

working backwards by \eqref{S1} we can conclude

\begin{equation}
t \arr{f} t'' \qquad t'' \arr{g|h} t'
\end{equation}

There are two possible sub-cases from $t'' \arr{g|h} t'$. From
\eqref{C1} we could conclude

\begin{equation}
t'' \arr{g} t'
\end{equation}

and since we have established $t \arr{f} t''$ we have 

\begin{equation}
t \arr{f} t'' \qquad t'' \arr{g} t'
\end{equation}

and thus, by \eqref{S1}, we have

\begin{equation}
t \arr{f;g} t'
\end{equation}

and by \eqref{C1} we have

\begin{equation}
t \arr{(f;g)|(f;h)} t'
\end{equation}

and this sub-case is complete. The next sub-case from $t''
\arr{g|h} t'$ by \eqref{C2} is that

\begin{equation}
t'' \arr{g} \bot \qquad t'' \arr{h} t'
\end{equation}

By \eqref{S2}:

\begin{equation}
t \arr{f;g} \bot
\end{equation}

By \eqref{S1}:

\begin{equation}
t \arr{f;h} t'
\end{equation}

By \eqref{C2}:

\begin{equation}
t \arr{(f;g)|(f;h)} t'
\end{equation}

And this sub-case is complete. Next we must show 

\begin{equation}
t \arr{f;(g|h)} \bot \implies t \arr{(f;g)|(f;h)} \bot
\end{equation}

We assume the premise

\begin{equation}
t \arr{f;(g|h)} \bot
\end{equation}

Case \#1:

By \eqref{S2}:

\begin{equation}
t \arr{f} \bot
\end{equation}

By \eqref{S2}:

\begin{equation}
t \arr{f;g} \bot \qquad t \arr{f;h} \bot
\end{equation}

By \eqref{C3}:

\begin{equation}
t \arr{(f;g)|(f;h)} \bot
\end{equation}

Case \#2:

By \eqref{S3}:

\begin{equation}
t \arr{f} t' \qquad t' \arr{g|h} \bot
\end{equation}

By \eqref{C3}:

\begin{equation}
t \arr{f} t' \qquad t' \arr{g} \bot \qquad t' \arr{h} \bot
\end{equation}

By \eqref{S3}:

\begin{equation}
t \arr{f;g} \bot \qquad t \arr{f;h} \bot
\end{equation}

By \eqref{C3}:

\begin{equation}
t \arr{(f;g)|(f;h)} \bot
\end{equation}

\subsubsection{From the right}

It turns out that although sequence distributes over choice from
the left, it does not do so from the right.

\begin{equation}
\label{FROM_RIGHT}
(f|g);h \not\implies (f;h)|(g;h)
\end{equation}

We can easily show this with a counterexample. Assume we have
three expressions

\begin{equation}
t_1 \arr{f} t_2 \qquad t_1 \arr{g} t_3 \qquad t_3 \arr{h} t_4
\end{equation}

Now we can see that 

\begin{equation}
t_1 \arr{(f|g);h} \bot
\end{equation}

but

\begin{equation}
t_1 \arr{(f;h)|(g;h)} t_4
\end{equation}

So

\begin{equation}
t \arr{(f|g);h} \bot \not\implies t \arr{(f;h)|(g;h)} \bot
\end{equation}

which would be required to show \eqref{FROM_RIGHT}.


\subsection{Distribution of congruence over sequence}

Here, we want to show that congruence distributes over sequence,
i.e., that

\begin{equation}
\{r_1,\ldots,r_n\};\{s_1,\ldots,s_n\}
\implies
\{r_1;s_1,\ldots,r_n;s_n\}
\end{equation}

Case \#1:

\begin{equation}
(t_1,\ldots,t_n) \arr{\{r_1,\ldots,r_n\};\{s_1,\ldots,s_n\}} (t'_1,\ldots,t'_n) \implies (t_1,\ldots,t_n) \arr{\{r_1;s_1,\ldots,r_n;s_n\}} (t'_1,\ldots,t'_n)
\end{equation}

By \eqref{S1}:

\begin{equation}
(t_1,\ldots,t_n) \arr{\{r_1,\ldots,r_n\}} (t''_1,\ldots,t''_n)
\qquad
(t''_1,\ldots,t''_n) \arr{\{s_1,\ldots,s_n\}} (t'_1,\ldots,t'_n)
\end{equation}

By \eqref{T1}:

\begin{equation}
t_1 \arr{r_1} t''_1
\;\cdots\;
t_n \arr{r_n} t''_n
\qquad
t''_1 \arr{s_1} t'_1
\;\cdots\;
t''_n \arr{s_n} t'_n
\end{equation}

By \eqref{S1}:

\begin{equation}
t_1 \arr{r_1;s_1} t'_1
\;\cdots\;
t_n \arr{r_n;s_n} t'_n
\end{equation}

By \eqref{T1}:

\begin{equation}
\{r_1;s_1,\ldots,r_n;s_n\}
\end{equation}

Case \#2:

\begin{equation}
(t_1,\ldots,t_n) \arr{\{r_1,\ldots,r_n\};\{s_1,\ldots,s_n\}} \bot \implies (t_1,\ldots,t_n) \arr{\{r_1;s_1,\ldots,r_n;s_n\}} \bot
\end{equation}

Assume the premise:

\begin{equation}
(t_1,\ldots,t_n) \arr{\{r_1,\ldots,r_n\};\{s_1,\ldots,s_n\}} \bot
\end{equation}

Sub-case \#1 by \eqref{S2}:

\begin{equation}
(t_1,\ldots,t_n) \arr{\{r_1,\ldots,r_n\}} \bot
\end{equation}

By \eqref{T2}:

\begin{equation}
t_i \arr{r_i} \bot \;\mbox{where}\; 1 \leq i \leq n
\end{equation}

By \eqref{S2}:

\begin{equation}
t_i \arr{r_i;s_i} \bot
\end{equation}

By \eqref{T2}:

\begin{equation}
t_i \arr{\{\ldots,r_i;s_i,\ldots\}} \bot
\end{equation}

Sub-case \#2 by \eqref{S3}:

\begin{equation}
(t_1,\ldots,t_n) \arr{\{r_1,\ldots,r_n\}} (t'_1,\ldots,t'_n)
\qquad
(t'_1,\ldots,t'_n) \arr{\{s_1,\ldots,s_n\}} \bot
\end{equation}

By \eqref{T1}:

\begin{equation}
t_1 \arr{r_1} t'_1 \;\cdots\; t_n \arr{r_n} t'_n
\end{equation}

By \eqref{T2}:

\begin{equation}
t'_i \arr{s_i} \bot \;\mbox{where}\; 1 \leq i \leq n
\end{equation}

By \eqref{S3}:

\begin{equation}
t_i \arr{r_i;s_i} \bot
\end{equation}

By \eqref{T2}:

\begin{equation}
(\ldots,t_i,\ldots) \arr{\{\ldots,r_i;s_i,\ldots\}} \bot
\end{equation}
