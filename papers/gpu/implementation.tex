%!TEX root = twig-gpu.tex

\section{Implementation}

Our implementation of Twig is written in Haskell. Twig expects as input a \texttt{.twig} file containing a list of named rule expressions along with a \texttt{main} rule expression, as described in Section~\ref{section:names}. It also expects an initial value (i.e. a term, representing a C type), which will be used as the input to the main rule expression.

Twig must also be configured with a mapping from terms to C types. Currently, this mapping is provided with a simple key/value text file, but we are working on a more flexible alternative.

\subsection{C Code Generation}

Twig is capable of generating any procedural language, but in practice implementations must take the target language into account. Our current implementation of Twig is targeted to generate C code. For convenience, our implementation will handle tasks such as declaring variables, generating unique names, and ensuring that for sequencing blocks the outputs are assigned to the inputs in the appropriate way.

Optionally, generated code may be wrapped in a C function body, with parameters corresponding to the inputs, and return value corresponding to the output. If the input value can be successfully rewritten using the main rule expression provided, then Twig will output the rewritten term along with the generated block of C code. If desired, this code block may be redirected to a separate file and included in a C program using the \texttt{\#include} directive.
