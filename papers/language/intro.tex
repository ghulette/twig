%!TEX root = twig-language.tex

\section{Introduction}

Twig is a new language for writing \emph{typemaps} -- programs
that transform data from one type to another, while preserving (as
much as possible) the underlying value of the data. Typemaps have
proven useful in many kinds of programming and especially
automated code generation, where we require a transformation to
pass a single nominal value across a pair of mismatched types that
we know to be interchangeable in some way. The best-known example
of this problem is found in multi-language programming. For
example, a programmer may wish to pass a Python integer to a C
function, where a C int is expected. If we have a typemap that
performs the transformation from Python integers to C integers,
then an automated tool can generate the conversion code
automatically, and expose the C function in Python via a generated
wrapper.

There are a number of existing tools and languages for creating
typemaps and generating code from them. Twig builds on existing
typemap tools in several ways.

First, Twig's typemaps are composable, i.e., new typemaps may be
constructed by combining old ones. Thus, complex typemap
transformations may be built from simpler ones. Our notion of
typemap composition is based on the formalisms used in
Fig\cite{reppy:fig}, but we extend and refine that work in some
key ways. In particular, we introduce a notion of functors over
typemaps. Functors permit typemaps to be parameterized with other
typemaps, allowing nested transformations to be cleanly expressed.

Second, Twig incorporates a robust, formal model of code
generation. This allows Twig to generate code based on typemaps in
many different target languages.

Finally, Twig includes a facility for \emph{reducing} typemaps by
exploiting identity relationships among typemap expressions. Some
reductions are based on a universal ``algebra of typemaps,'' while
others are domain-specific and must be described by the user. We
have show in our prior work \cite{ourselves} that typemap
reduction can be used to optimize certain transformations. Since
reductions are covered in our previous work, we will not address
them here.

In this paper, we will describe Twig's formal language structure,
and then show how this structure allows us to express complex
typemaps more concisely than with traditional tools. First, we
review existing approaches to typemaps and related problems.
Second, we present the semantics for Twig's code generation model,
and then the semantics for the typemap language itself. Third, we
present a typemap example in Swig, and show how the same problem
can be solved more concisely and clearly in Twig. Finally, we
conclude with ideas for future work.
