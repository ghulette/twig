TODO:
* Variable joins in literals
* Trace rewriting
